common_install_docker: True
docker_install: False
mysql_install_server: False

nginx_reverse_proxy_port: "8080/knowage"

docker_applications:
  - phpmyadmin
  
init_docker:
  onlyoffice:
    db: mariadb
    db_name: knowage
    db_username: knowagedb
    db_password: "123456"
    username: biadmin
    password: "biadmin"
    service_after: "docker.service"
    compose_path: "/data/wwwroot/onlyoffice/docker-compose.yml"
    compose_commands:
      - sudo sed -i "s/123456/$new_password/g" /data/wwwroot/knowage/knowage-server/.env
    volumes: 
      - /data/wwwroot/knowage/knowage-server/db/
      - /data/wwwroot/knowage/knowage-server/cache/
    commands:
      - sleep 10
      - sudo rm -rf /data/tomcat/work/Catalina
      - sudo sed -i 's/password="biadmin"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/config/internal_profiling.xml
      - sudo sed -i 's/password="biadmin"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/webapp/authorizations.xml
      - sudo sed -i 's/password="bidev"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/config/internal_profiling.xml
      - sudo sed -i 's/password="bidev"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/webapp/authorizations.xml
      - sudo sed -i 's/password="biuser"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/config/internal_profiling.xml
      - sudo sed -i 's/password="biuser"/password="'$new_password'"/' /data/tomcat/webapps/knowage/WEB-INF/conf/webapp/authorizations.xml